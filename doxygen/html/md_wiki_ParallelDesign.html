<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>parallel-preprocessor: Parallel Design</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">parallel-preprocessor
   &#160;<span id="projectnumber">0.3.0.02eb887</span>
   </div>
   <div id="projectbrief">MPI distributive and multithreading massively parallel geometry processor     for large scale CAE and machine learning, by Qingfeng Xia, UKAEA, 2019</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_wiki_ParallelDesign.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Parallel Design </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Workflow Topology</h1>
<p>Currenlty only linear pipeline (single-way linear) is supported, more complicated graph dataflow as in Apache NIFI, Tensorflow, has not been implemented.</p>
<p><a href="https://nifi.apache.org/docs/nifi-docs/html/user-guide.html#User_Interface">https://nifi.apache.org/docs/nifi-docs/html/user-guide.html#User_Interface</a></p>
<p><code>Cpp-Taskflow</code> library is by far a faster, more expressive, and easier for drop-in integration for the single-way linear task programming.</p>
<h1>Executor</h1>
<p>Currently, only CPU device is supported, althoug GPU acceleraton will be considered in the future. It is expected the Processor should has a characteristics of <code>enum DevicePreference {CPU, GPU}</code></p>
<ul>
<li>multiple threading (shared memory), TBB task_group is used, but can be switched to a single-header thread pool implementation. synchronous multi-threading (wait until all threads complete tasks) and asynchronous dispatcher (now default) have been implemented. <img src="./PPP_asyn_multiple_threading.png" alt="asynchronous dispatcher can fully utilise multi-core CPU" class="inline"/></li>
<li>MPI (distributive, NUMA) This is useful for distributive meshing, since memory capacity on a single multi-core node may be not sufficient to mesh large assemblies. <a href="https://github.com/STEllAR-GROUP/hpx">HPX</a> is a library that unitify the API for multi-threading and distributve parallelization. libraries such as <code>OpenMP Tasking</code> and <code>Intel TBB FlowGraph</code> in handling complex parallel workloads. TensorFlow has the concept of graph simplication.</li>
</ul>
<h2>Thread Pool Executor</h2>
<ul>
<li>currently, intel TBB <code>task_group</code>, internally it could be a threadpool, is used</li>
<li>OpenCASCADE has <code>ThreadPool</code> class, can be a choice <a href="https://www.opencascade.com/doc/occt-7.4.0/refman/html/class_o_s_d___thread_pool.html">https://www.opencascade.com/doc/occt-7.4.0/refman/html/class_o_s_d___thread_pool.html</a></li>
<li><a class="el" href="classA.html" title="a dummy class to test property container">A</a> simple C++11 Thread Pool implementation, license: Zlib <a href="https://github.com/progschj/ThreadPool">https://github.com/progschj/ThreadPool</a></li>
</ul>
<p>The class name should be identical to Python's <code>concurrent.futures</code> module like <code>ThreadPool</code> <code>ProcessPoolExecutor</code> <a href="https://docs.python.org/3/library/concurrent.futures.html">https://docs.python.org/3/library/concurrent.futures.html</a></p>
<h2>Process Pool Executor</h2>
<p>Python's <code>ProcessPoolExecutor</code> implements similar API as <code>ProcessPoolExecutor</code>, but all processes are still on the localhost (not distributive). MPI distributive parallel is also on Process level, does not share the memory address.</p>
<h2>Parallel computation on GPU</h2>
<p>GPU parallel is under investigation, it is expected single-source, which can fall back to CPU parallel. GPU offloading may also be considered.</p>
<p>For some simple data type like image and text, it is expected computation can be done on GPU</p><ol type="1">
<li>GPU may be achieved by third-party library implicitly, in that case, only one thread per GPU is used For example, OpenMP may be offloaded to GPU, Nvidia has stdc++ lib to offload some operaton to GPU.</li>
<li>write the GPU kernel source and the <code>GpuExecutor</code> will schedule the work.</li>
</ol>
<div class="fragment"><div class="line"><span class="keyword">enum class</span> DataType</div>
<div class="line">{</div>
<div class="line">    Any = 0,  </div>
<div class="line">    Text,</div>
<div class="line">    Image,</div>
<div class="line">    Audio,</div>
<div class="line">    Video,</div>
<div class="line">    Geometry</div>
<div class="line">};</div>
</div><!-- fragment --><p>SYCL is the single source OpenCL, to write new processor in C++.</p>
<h1>Concurrent data access</h1>
<h2>STL vector with parallel accessor without lock</h2>
<p>The main thread allocate the <code>std::vector&lt;&gt;</code> with enough size by <code>resize(capacity, value)</code>, to avoid resize during parallel operation by worker threads. <code>std::vector&lt;&gt;</code> can be read and write its own own range of a specific worker thread, without lock. Access controller is needed to make sure read and write to other thread's memory zone is valid.</p>
<p><code>std::vector::resize(capacity, value)</code> will not only reserve memory but also set a initial value, if not provided then default value. <code>std::vector::reserve(capacity)</code> reserver the contiguous memory region, but it does not really increase vector <code>size()</code>.</p>
<p>currently a template alias is used, for potential replacement for distributive MPI parallel <code>template &lt;class T&gt; using VectorType = std::vector&lt;T&gt;;</code></p>
<h2>Concurrent data structure with lock underneath</h2>
<p><a href="https://github.com/FEniCS/dolfin/tree/master/dolfin/la">https://github.com/FEniCS/dolfin/tree/master/dolfin/la</a> TBB has some concurrent data structure, C++17 standard c++ parallel library seems based on TBB.</p>
<h1>Distributive parallel design</h1>
<p>The master node do the split, feeding each worker node with a collection of shapes and meta info (json) for each shape. The master will build the topology (graph, boundbox tree), which will be shared by all nodes. Each worker works on the split dataset indepedently like shape checking and meshing while it sends some meta information back to the master to build global information data structure. <br  />
</p>
<p><a class="el" href="namespacePPP.html">PPP</a> may also write the case input files, some part recongination, boundary condition setup, OpenMC/FEM/CFD solver are considered in this pattern. Natural part shared face during assembly splitting is used for <code>interprocessor</code> boundary conditions. The master node is responsible to doe boundary updating. PreCICE may be used for boundary update.</p>
<p><a href="http://www.libgeodecomp.org/">http://www.libgeodecomp.org/</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
